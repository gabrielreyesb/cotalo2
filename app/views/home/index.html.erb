<%# Product Image Section %>
<div class="product-intro-section py-2">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center">
        <%= image_tag "productonew.png", 
            alt: "Producto Cotalo", 
            class: "img-fluid product-intro-image",
            style: "max-width: 600px; border-radius: 12px; box-shadow: 0 8px 32px rgba(66, 185, 131, 0.2);" %>
      </div>
    </div>
  </div>
</div>

<%# Hero Section %>
<div class="hero-section py-2">
  <div class="container">
    <div class="row align-items-center">
      <!-- Left Column: Main Content -->
      <div class="col-lg-6 col-12 d-flex flex-column text-center text-lg-start">
        <% if user_signed_in? %>
          <h1 class="display-3 mb-4 hero-title"><%= t('home.hero_title') %></h1>
        <% else %>
          <%= link_to new_user_registration_path, class: "text-decoration-none" do %>
            <h1 class="display-3 mb-4 hero-title hero-title-link"><%= t('home.hero_title') %></h1>
          <% end %>
        <% end %>
        
        <p class="lead mb-4 hero-subtitle">
          <%= t('home.hero_subtitle') %>
        </p>
        <% if user_signed_in? %>
          <div class="d-flex justify-content-center justify-content-lg-start mb-4">
            <%= link_to dashboard_path, class: "btn btn-success btn-lg" do %>
              <i class="fas fa-tachometer-alt me-2"></i><%= t('home.go_to_dashboard') %>
            <% end %>
          </div>
        <% end %>
      </div>
      
      <!-- Right Column: Steps Animation -->
      <div class="col-lg-6 col-12 d-flex flex-column align-items-center justify-content-center">
                     <div class="steps-animation-container clickable-steps" data-bs-toggle="modal" data-bs-target="#stepsModal" style="cursor: pointer;">
               <h3 class="steps-title mb-4"><%= t('home.steps_animation.title') %></h3>
               <div class="steps-animation">
                 <div class="step-number">1</div>
                 <div class="step-text" id="animated-step-text">
                   <%= t('home.steps_animation.step1').html_safe %>
                 </div>
               </div>
             </div>
        <% unless user_signed_in? %>
          <div class="mt-4">
            <%= link_to new_user_registration_path, class: "btn btn-success btn-lg" do %>
              <i class="fas fa-rocket me-2"></i><%= t('home.register_free') %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Mobile Scroll Indicator -->
    <div class="scroll-indicator d-block d-lg-none text-center py-3">
      <div class="scroll-hint">
        <p class="scroll-text mb-2 text-muted">Desliza para ver más</p>
        <div class="scroll-arrow">
          <i class="fas fa-chevron-down"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Benefits Section with Pricing Preview %>
<div class="benefits-section py-5">
  <div class="container">
    <h2 class="text-center mb-5"><%= t('home.benefits_title') %></h2>
    <div class="row align-items-center">
      <!-- Benefits List Column -->
      <div class="col-lg-6 col-12 mb-4 mb-lg-0">
        <div class="benefits-list">
          <div class="benefit-item mb-4">
            <div class="d-flex align-items-start">
              <i class="fas fa-clock fa-2x me-3" style="color: var(--cotalo-green); flex-shrink: 0; margin-top: 4px;"></i>
              <div>
                <h5 class="mb-2"><%= t('home.benefit1_title') %></h5>
                <p class="mb-0"><%= t('home.benefit1_desc') %></p>
              </div>
            </div>
          </div>
          
          <div class="benefit-item mb-4">
            <div class="d-flex align-items-start">
              <i class="fas fa-check-circle fa-2x me-3" style="color: var(--cotalo-green); flex-shrink: 0; margin-top: 4px;"></i>
              <div>
                <h5 class="mb-2"><%= t('home.benefit2_title') %></h5>
                <p class="mb-0"><%= t('home.benefit2_desc') %></p>
              </div>
            </div>
          </div>
          
          <div class="benefit-item mb-4">
            <div class="d-flex align-items-start">
              <i class="fas fa-chart-line fa-2x me-3" style="color: var(--cotalo-green); flex-shrink: 0; margin-top: 4px;"></i>
              <div>
                <h5 class="mb-2"><%= t('home.benefit3_title') %></h5>
                <p class="mb-0"><%= t('home.benefit3_desc') %></p>
              </div>
            </div>
          </div>
          
          <div class="benefit-item mb-4">
            <div class="d-flex align-items-start">
              <i class="fas fa-user-friends fa-2x me-3" style="color: var(--cotalo-green); flex-shrink: 0; margin-top: 4px;"></i>
              <div>
                <h5 class="mb-2"><%= t('home.benefit4_title') %></h5>
                <p class="mb-0"><%= t('home.benefit4_desc') %></p>
              </div>
            </div>
          </div>
          
          <div class="benefit-item">
            <div class="d-flex align-items-start">
              <i class="fas fa-print fa-2x me-3" style="color: var(--cotalo-green); flex-shrink: 0; margin-top: 4px;"></i>
              <div>
                <h5 class="mb-2"><%= t('home.benefit5_title') %></h5>
                <p class="mb-0"><%= t('home.benefit5_desc') %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pricing Preview Column -->
      <div class="col-lg-6 col-12 d-flex justify-content-center">
        <div class="pricing-preview">
          <h5 class="text-center mb-4" style="color: var(--cotalo-green);">Nivel de detalle del costeo</h5>
          <div class="pricing-image-container">
            <%= image_tag "costeo.png", 
                alt: "Tab de precios detallado - Cotalo", 
                class: "img-fluid pricing-screenshot clickable-image",
                style: "max-width: 494px; max-height: 585px; border-radius: 8px; box-shadow: 0 4px 20px rgba(66, 185, 131, 0.3); cursor: pointer;",
                data: { bs_toggle: "modal", bs_target: "#pricingImageModal" } %>
            <p class="text-center mt-3 text-muted small">
              <i class="fas fa-search-plus me-1"></i>Desglose completo de costos por materiales, procesos e indirectos (clic para ampliar)
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Features Section %>
<div class="features-section py-5">
  <div class="container">
    <h2 class="text-center mb-5"><%= t('home.features_title') %></h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="text-center">
          <i class="fas fa-pencil-ruler fa-3x mb-3" style="color: var(--cotalo-green);"></i>
          <h5><%= t('home.feature1_title') %></h5>
          <p><%= t('home.feature1_desc') %></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="text-center">
          <i class="fas fa-calculator fa-3x mb-3" style="color: var(--cotalo-green);"></i>
          <h5><%= t('home.feature2_title') %></h5>
          <p><%= t('home.feature2_desc') %></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="text-center">
          <i class="fas fa-file-invoice-dollar fa-3x mb-3" style="color: var(--cotalo-green);"></i>
          <h5><%= t('home.feature3_title') %></h5>
          <p><%= t('home.feature3_desc') %></p>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Quote Preview Section %>
<div class="quote-preview-section py-3">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <div class="quote-preview text-center">
          <div class="quote-image-container text-center">
            <%= image_tag "cotizacion_ejemplo.png", 
                alt: "Ejemplo de cotización profesional generada por Cotalo", 
                class: "img-fluid quote-screenshot clickable-image",
                style: "max-width: 500px; border-radius: 8px; box-shadow: 0 4px 20px rgba(66, 185, 131, 0.3); cursor: pointer; margin: 0 auto; display: block;",
                data: { bs_toggle: "modal", bs_target: "#quoteImageModal" } %>
            <p class="text-center mt-3 text-muted small">
              <i class="fas fa-search-plus me-1"></i>Clic para ampliar
            </p>
          </div>
        </div>
        
        <% unless user_signed_in? %>
          <div class="mt-4 text-center">
            <%= link_to new_user_registration_path, class: "btn btn-success btn-lg" do %>
              <i class="fas fa-rocket me-2"></i>Probar Gratis
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%# Multiple Processes Section %>
<div class="multiple-processes-section py-5 bg-darker">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h2 class="mb-4">Procesos múltiples y control total</h2>
        <p class="lead mb-4">
          Cada producto puede incluir múltiples materiales y, para cada uno, los procesos necesarios para su fabricación: impresión, laminado, troquelado, armado, o cualquier otro que requieras.
        </p>
        <div class="checklist d-flex flex-column align-items-start gap-3 mb-4">
          <div class="d-flex align-items-center">
            <i class="fas fa-check-circle text-success me-2"></i>
            <span>Asigna procesos específicos a cada material</span>
          </div>
          <div class="d-flex align-items-center">
            <i class="fas fa-check-circle text-success me-2"></i>
            <span>Calcula el costo exacto por etapa</span>
          </div>
          <div class="d-flex align-items-center">
            <i class="fas fa-check-circle text-success me-2"></i>
            <span>Obtén el precio total por pieza, claro y detallado</span>
          </div>
        </div>
        <p class="mb-0">
          Cotalo te da el control completo del costeo de productos gráficos con múltiples procesos, sin complicaciones de ERP.
        </p>
      </div>
    </div>
  </div>
</div>

<%# How It Works Section %>
<div class="how-it-works-section py-5">
  <div class="container d-flex flex-column align-items-center">
    <div class="collapsible-header d-flex flex-column align-items-center justify-content-center mb-4 clickable-link" style="cursor:pointer; user-select:none;" onclick="toggleFlowSection()">
      <div class="d-flex align-items-center justify-content-center">
        <h2 class="text-center mb-0 me-2 text-white"><%= t('home.how_title') %></h2>
        <i id="flowChevron" class="fas fa-chevron-down text-success" style="transition: transform 0.3s;"></i>
      </div>
      <span id="flowHelperText" class="text-success small mt-2"><%= t('home.flow.helper_text_show') %></span>
    </div>
    
    <!-- Demo Request Button -->
    <div class="text-center mb-4">
      <%= link_to new_demo_request_path, class: "btn btn-outline-success btn-lg" do %>
        <i class="fas fa-play-circle me-2"></i><%= t('home.request_demo') %>
      <% end %>
    </div>
    <div id="flowSection" style="width:100%; transition: max-height 0.4s cubic-bezier(0.4,0,0.2,1); overflow: hidden; max-height: 0px;">
      <div class="flow-diagram w-100 mx-auto" style="max-width: 800px; display: block;">
        <!-- 1. Configuración del Sistema -->
        <h4 class="section-title"><%= t('home.flow.section1_title') %></h4>
        <div class="mb-3">
          <div class="step-card config-step">
            <div class="step-icon config-icon"><i class="fas fa-user fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step1_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step1_desc') %></div>
            </div>
          </div>
          <div class="arrow"><i class="fas fa-arrow-down"></i></div>
          <div class="step-card config-step">
            <div class="step-icon config-icon"><i class="fas fa-sliders-h fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step2_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step2_desc') %></div>
            </div>
          </div>
          <div class="arrow"><i class="fas fa-arrow-down"></i></div>
          <div class="step-card config-step">
            <div class="step-icon config-icon"><i class="fas fa-percentage fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step3_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step3_desc') %></div>
            </div>
          </div>
        </div>

        <!-- 2. Preparación de la Cotización -->
        <h4 class="section-title"><%= t('home.flow.section2_title') %></h4>
        <div class="mb-3">
          <div class="step-card prep-step">
            <div class="step-icon prep-icon"><i class="fas fa-users fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step4_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step4_desc') %></div>
            </div>
          </div>
          <div class="arrow"><i class="fas fa-arrow-down"></i></div>
          <div class="step-card prep-step">
            <div class="step-icon prep-icon"><i class="fas fa-file-alt fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step5_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step5_desc') %></div>
            </div>
          </div>
        </div>

        <!-- 3. Calculo de productos y envío de cotización -->
        <h4 class="section-title"><%= t('home.flow.section3_title') %></h4>
        <div>
          <div class="step-card quote-step">
            <div class="step-icon quote-icon"><i class="fas fa-cube fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step6_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step6_desc') %></div>
            </div>
          </div>
          <div class="arrow"><i class="fas fa-arrow-down"></i></div>
          <div class="step-card quote-step">
            <div class="step-icon quote-icon"><i class="fas fa-plus fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step7_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step7_desc') %></div>
            </div>
          </div>
          <div class="arrow"><i class="fas fa-arrow-down"></i></div>
          <div class="step-card final-step">
            <div class="step-icon final-icon"><i class="fas fa-envelope fa-lg"></i></div>
            <div>
              <div class="fw-semibold" style="color: var(--text-primary);"><%= t('home.flow.step8_title') %></div>
              <div class="small" style="color: var(--text-secondary);"><%= t('home.flow.step8_desc') %></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# CTA Section %>
<div class="cta-section py-5">
  <div class="container text-center">
    <h2 class="mb-4"><%= t('home.cta_title') %></h2>
    <p class="lead mb-4"><%= t('home.cta_subtitle') %></p>
    <% if user_signed_in? %>
      <%= link_to dashboard_path, class: "btn btn-success btn-lg" do %>
        <i class="fas fa-tachometer-alt me-2"></i><%= t('home.go_to_dashboard') %>
      <% end %>
    <% else %>
      <%= link_to new_user_registration_path, class: "btn btn-success btn-lg" do %>
        <i class="fas fa-rocket me-2"></i><%= t('home.register_free') %>
      <% end %>
    <% end %>
    <div class="mt-4">
      <a href="<%= suggestions_path %>" class="text-success fw-bold" style="text-decoration: underline;">
        <%= t('home.suggestions_info') %>
      </a>
    </div>
  </div>
</div>

<%# Footer - Only show on homepage %>
<%= render 'shared/footer' %>

<%# Image Modals %>
<!-- Steps Process Modal -->
<div class="modal fade" id="stepsModal" tabindex="-1" aria-labelledby="stepsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="stepsModalLabel" style="color: var(--cotalo-green);">
          <i class="fas fa-list-ol me-2"></i><span id="stepModalTitle">Paso 1: Información General</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-2">
        <img id="stepModalImage" 
             src="<%= asset_path('cotizacion_ejemplo.png') %>" 
             alt="Paso del proceso de cotización" 
             class="img-fluid"
             style="max-width: 80%; max-height: 70vh; height: auto; border-radius: 8px; box-shadow: 0 4px 20px rgba(66, 185, 131, 0.3); object-fit: contain;">
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <p class="text-muted mb-0" id="stepModalDescription">
          <i class="fas fa-info-circle me-1"></i>
          <span id="stepModalText">Llenar datos generales como cantidad de piezas y sus dimensiones</span>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Pricing Image Modal -->
<div class="modal fade" id="pricingImageModal" tabindex="-1" aria-labelledby="pricingImageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="pricingImageModalLabel" style="color: var(--cotalo-green);">
          <i class="fas fa-calculator me-2"></i>Nivel de detalle del costeo
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-0">
        <%= image_tag "costeo.png", 
            alt: "Tab de precios detallado - Cotalo", 
            class: "img-fluid",
            style: "max-width: 100%; height: auto; border-radius: 8px;" %>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <p class="text-muted mb-0">
          <i class="fas fa-info-circle me-1"></i>
          Desglose completo de costos por materiales, procesos e indirectos
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Quote Image Modal -->
<div class="modal fade" id="quoteImageModal" tabindex="-1" aria-labelledby="quoteImageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="quoteImageModalLabel" style="color: var(--cotalo-green);">
          <i class="fas fa-file-invoice-dollar me-2"></i>Ejemplo de cotización generada
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-0">
        <%= image_tag "cotizacion_ejemplo.png", 
            alt: "Ejemplo de cotización profesional generada por Cotalo", 
            class: "img-fluid",
            style: "max-width: 100%; height: auto; border-radius: 8px;" %>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <p class="text-muted mb-0">
          <i class="fas fa-info-circle me-1"></i>
          Ejemplo de cotización generada por Cotalo
        </p>
      </div>
    </div>
  </div>
</div>

<%# All custom styles moved to app/assets/stylesheets/components/_home.scss %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Flow section functionality
  if (document.getElementById('flowChevron')) {
    document.getElementById('flowChevron').style.transform = 'rotate(-90deg)';
    document.getElementById('flowHelperText').textContent = '<%= t('home.flow.helper_text_show') %>';
  }
  
  // Scroll indicator functionality
  const scrollIndicator = document.querySelector('.scroll-indicator');
  let hasScrolled = false;
  
  if (scrollIndicator) {
    window.addEventListener('scroll', function() {
      if (!hasScrolled && window.scrollY > 50) {
        hasScrolled = true;
        scrollIndicator.classList.add('hidden');
        
        // Remove from DOM after animation
        setTimeout(() => {
          if (scrollIndicator.parentNode) {
            scrollIndicator.parentNode.removeChild(scrollIndicator);
          }
        }, 500);
      }
    });
  }
  
  // Steps animation functionality
  const stepTexts = [
    '<%= t('home.steps_animation.step1').html_safe %>',
    '<%= t('home.steps_animation.step2').html_safe %>',
    '<%= t('home.steps_animation.step3').html_safe %>',
    '<%= t('home.steps_animation.step4').html_safe %>',
    '<%= t('home.steps_animation.step5').html_safe %>'
  ];
  
  // Step data for modal
  const stepData = [
    {
      title: 'Paso 1: Información General',
      image: '<%= asset_path('infogeneral.png') %>',
      description: 'Llenar datos generales como cantidad de piezas y sus dimensiones'
    },
    {
      title: 'Paso 2: Materiales y Procesos',
      image: '<%= asset_path('materiales.png') %>',
      description: 'Indicar los materiales a utilizar y asigna que procesos se le aplican a cada material'
    },
    {
      title: 'Paso 3: Procesos Globales',
      image: '<%= asset_path('procesos.png') %>',
      description: 'Indicar que procesos se aplican a todas las piezas terminadas'
    },
    {
      title: 'Paso 4: Costos Extras',
      image: '<%= asset_path('extras.png') %>',
      description: 'Indicar que costos extras deberán aplicar al proyecto'
    },
    {
      title: 'Paso 5: Cotización Lista',
      image: '<%= asset_path('costos.png') %>',
      description: 'El cálculo del costo de tu proyecto ya está listo. Genera y envía tu cotización'
    }
  ];
  
  const stepTextElement = document.getElementById('animated-step-text');
  const stepNumberElement = document.querySelector('.step-number');
  const clickableSteps = document.querySelector('.clickable-steps');
  
  if (stepTextElement && stepNumberElement) {
    let currentStep = 0;
    
    function animateToNextStep() {
      // Add fade out effect
      stepTextElement.style.opacity = '0';
      stepNumberElement.style.opacity = '0';
      
      setTimeout(() => {
        currentStep = (currentStep + 1) % stepTexts.length;
        stepTextElement.innerHTML = stepTexts[currentStep];
        stepNumberElement.textContent = currentStep + 1;
        
        // Add fade in effect
        stepTextElement.style.opacity = '1';
        stepNumberElement.style.opacity = '1';
      }, 300);
    }
    
    // Handle click on steps animation to show modal
    if (clickableSteps) {
      clickableSteps.addEventListener('click', function() {
        const modalTitle = document.getElementById('stepModalTitle');
        const modalImage = document.getElementById('stepModalImage');
        const modalText = document.getElementById('stepModalText');
        
        if (modalTitle && modalImage && modalText) {
          const stepInfo = stepData[currentStep];
          modalTitle.textContent = stepInfo.title;
          modalImage.src = stepInfo.image;
          modalImage.alt = stepInfo.title;
          modalText.textContent = stepInfo.description;
        }
      });
    }
    
    // Start animation after 2 seconds, then repeat every 4 seconds
    setTimeout(() => {
      animateToNextStep();
      setInterval(animateToNextStep, 4000);
    }, 2000);
  }
});

function toggleFlowSection() {
  const section = document.getElementById('flowSection');
  const chevron = document.getElementById('flowChevron');
  const helper = document.getElementById('flowHelperText');
  if (section.style.maxHeight && section.style.maxHeight !== '0px') {
    section.style.maxHeight = '0px';
    chevron.style.transform = 'rotate(-90deg)';
    helper.textContent = '<%= t('home.flow.helper_text_show') %>';
  } else {
    section.style.maxHeight = '2000px';
    chevron.style.transform = 'rotate(0deg)';
    helper.textContent = '<%= t('home.flow.helper_text_hide') %>';
  }
}
</script>