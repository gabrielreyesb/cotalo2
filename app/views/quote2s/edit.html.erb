<% content_for :page_title, "Editar Cotización #{@quote.quote_number}" %>

<% content_for :page_actions do %>
  <%= link_to @quote, class: "btn btn-outline-light me-2" do %>
    <i class="fa fa-arrow-left me-1"></i> Volver
  <% end %>
  <%= link_to quote2s_path, class: "btn btn-outline-light me-2" do %>
    <i class="fa fa-list me-1"></i> Lista
  <% end %>
<% end %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Nota:</strong> La funcionalidad de edición está en desarrollo. 
        Por ahora, puedes ver los detalles de la cotización haciendo clic en "Volver".
        <br>
        <small class="text-muted">
          Para modificar una cotización, es recomendable crear una nueva copia con los cambios necesarios.
        </small>
      </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-lg-8">
      <!-- Basic Information -->
      <div class="card mb-4">
        <div class="card-header bg-dark text-light">
          <h5 class="mb-0">
            <i class="fas fa-edit me-2"></i>
            Información Básica
          </h5>
        </div>
        <div class="card-body">
          <%= form_with(model: @quote, local: true, class: "form") do |form| %>
            <% if @quote.errors.any? %>
              <div class="alert alert-danger">
                <h6><%= pluralize(@quote.errors.count, "error") %> impidieron que se guardara esta cotización:</h6>
                <ul class="mb-0">
                  <% @quote.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :client_name, "Nombre del cliente", class: "form-label" %>
                  <%= form.text_field :client_name, class: "form-control" %>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :client_company, "Compañía", class: "form-label" %>
                  <%= form.text_field :client_company, class: "form-control" %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :client_email, "Correo electrónico", class: "form-label" %>
                  <%= form.email_field :client_email, class: "form-control" %>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <%= form.label :client_phone, "Teléfono", class: "form-label" %>
                  <%= form.text_field :client_phone, class: "form-control" %>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <%= form.label :description, "Descripción", class: "form-label" %>
              <%= form.text_area :description, class: "form-control", rows: 3 %>
            </div>

            <div class="d-flex justify-content-end">
              <%= form.submit "Actualizar Cotización", class: "btn btn-primary me-2" %>
              <%= link_to "Cancelar", @quote, class: "btn btn-secondary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <!-- Current Quote Info -->
      <div class="card">
        <div class="card-header bg-dark text-light">
          <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>
            Información Actual
          </h5>
        </div>
        <div class="card-body">
          <p class="mb-2"><strong>Número:</strong> <%= @quote.quote_number %></p>
          <p class="mb-2"><strong>Total:</strong> $<%= number_with_precision(@quote.pricing['total_price'], precision: 2) %></p>
          <p class="mb-2"><strong>Cantidad:</strong> <%= number_with_delimiter(@quote.general_info['quantity']) %> piezas</p>
          <p class="mb-2"><strong>Dimensiones:</strong> <%= @quote.general_info['width'] %> x <%= @quote.general_info['length'] %> cm</p>
          <p class="mb-2"><strong>Creado:</strong> <%= @quote.created_at.strftime("%d/%m/%Y") %></p>
          <p class="mb-0"><strong>Actualizado:</strong> <%= @quote.updated_at.strftime("%d/%m/%Y") %></p>
        </div>
      </div>

      <!-- Warning -->
      <div class="card mt-3">
        <div class="card-header bg-warning text-dark">
          <h6 class="mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Importante
          </h6>
        </div>
        <div class="card-body">
          <small class="text-muted">
            La edición de cotizaciones está limitada a la información básica del cliente. 
            Para modificar materiales, procesos o cálculos, se recomienda crear una nueva cotización.
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
